@page "/cows"
@page "/cows/{SelectedCowID:int}"
@page "/cows/{SelectedCowID:int}/{LactationID:int}"
@page "/cows/{SomeTxtParam}"
@page "/krowy"

todo: Dodaj nową

@if (CowList != null)
{
    <h2>jp test bootsrap</h2>
    <select class="form-select" size="3" aria-label="size 3 select example">
      <option selected>Open this select menu</option>
      <option value="1">One</option>
      <option value="2">Two</option>
      <option value="3">Three</option>
    </select>

    <h3>Cows</h3>
    <select @onchange="ItemSelected" size="4" style="width:100%">
        @foreach (var cow in CowList)
        {
            <option value="@cow.ID.ToString()">@cow.NameOnFarm</option>
        }
    </select>

    @if (SelectedCow != null)
    {
        <br />
        <div>Informacje szczegółowe: 
            Oznaczenie na farmie: @SelectedCow.NameOnFarm 
            Płeć: @SelectedCow.IsMale ? "Samiec" : "Samica" </div>
    }
}

@code {
    List<Cow> CowList;
    Cow SelectedCow;

    [Parameter]
    public int? SelectedCowID { get; set; }

    [Parameter]
    public int? LactationID { get; set; } //todo

    [Parameter]
    public string SomeTxtParam { get; set; }

    public class Cow
    {
        public int ID { get; set; }//use by DB
        public int NameOnFarm { get; set; }//ID used on farm
        public int FarmID { get; set; }
        public int? ParentID { get; set; }

        public bool IsMale { get; set; }
    }

    void ItemSelected(ChangeEventArgs args)
        => SelectedCow = CowList.FirstOrDefault(x => x.ID.ToString() == args.Value.ToString());

    public override Task SetParametersAsync(ParameterView parameters)
    {
        //called as first method called when page load, before parameters are set, it happends each time we set params (not once like init)
        return base.SetParametersAsync(parameters);
    }

    protected override Task OnInitializedAsync()
    {
        //called second, after parameters are set, only once when page is initialized

        CowList = new List<Cow>()
        {
            new Cow(){ ID = 1, FarmID = 1, NameOnFarm = 203, IsMale = false },
            new Cow(){ ID = 2, FarmID = 1, NameOnFarm = 204, IsMale = false, ParentID = 1},
            new Cow(){ ID = 3, FarmID = 1, NameOnFarm = 205, IsMale = false, ParentID = 1 }
        };

        @if (SelectedCowID != null)
            SelectedCow = CowList.FirstOrDefault(x => x.ID == SelectedCowID);

        return base.OnInitializedAsync();
    }

    protected override Task OnParametersSetAsync()
    {
        //called each time when any of parameters is changes (set from other page or from same) - https://youtu.be/Rp-UDNLqZEc?t=1304
        return base.OnParametersSetAsync();
    }

    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        //called as last
        return base.OnAfterRenderAsync(firstRender);
    }
}
